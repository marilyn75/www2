(function () {
var simpleupload = (function () {
  'use strict';

  var global = tinymce.util.Tools.resolve('tinymce.PluginManager');

	var editorSimpleFileUpload = {
		open : function(id, value, type, win){
			var urltype=2;
			if (type=='image') { urltype=1; }
			if (type=='media') { urltype=3; }

			var editor = tinymce.activeEditor;

			editor.windowManager.open({
				title: "File Upload",
				//file: editor.settings.file_upload_form_path+'dialog.php?type='+urltype+'&descending='+descending+sort_by+fldr+crossdomain+'&lang='+editor.settings.language+'&akey='+akey,
				url:  editor.settings.file_upload_form_path + '/upload_form.php?sCode='+getThisConfigSiteCode()+'&type='+urltype,
				width: 360,  
				height: 100,
				resizable: false,
				maximizable: true,
				inline: 1
				},
				{
					upload_folder: "",
					setUrl: function (url) {
						var fieldElm = win.document.getElementById(id);
						fieldElm.value = editor.convertURL(url);

						if ("fireEvent" in fieldElm) {
							fieldElm.fireEvent("onchange")
						} else {
							var evt = document.createEvent("HTMLEvents");
							evt.initEvent("change", false, true);
							fieldElm.dispatchEvent(evt);
						}
						editor.windowManager.close();
					}
			});
		}
	}

  global.add('simpleupload', function (editor) {
    if (!editor.settings.file_browser_callback) {
      editor.settings.file_browser_callback = function (field_name, url, type, win) {
		editorSimpleFileUpload.open(field_name, url, type, win);
      };
    }
  });
  function Plugin () {
  }

  return Plugin;

}());
})();
